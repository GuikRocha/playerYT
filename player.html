<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Custom YouTube Player</title>

    <!-- Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">

    <style>
        /* Custom styles */
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000;
        }

        #player {
            width: 100%;
            height: 100%;
            position: relative;
            border-radius: 10px;
            overflow: hidden;
        }

        .plyr {
            filter: blur(1.5rem);
            transition: filter 1.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, .2);
        }

        .unmute-button {
            border: none;
            text-align: center;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ff3c3c;
            padding: 15px;
            border-radius: 5px;
            width: 50%;
            box-shadow: 0px 3px 10px #00000077;
            cursor: pointer;
            z-index: 9999999999;
            color: #fff;
            font-weight: bold;
            font-size: 1rem;
            transition: transform 0.3s ease;
        }

        .unmute-button:hover {
            transform: translate(-50%, -50%) scale(1.1);
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }
    </style>
</head>
<body>

    <div id="player"></div>

    <script>
        "use strict";

        let gInserted = false;
        let gInsertedScript = false;
        let unmute = false;

        function globalInsert() {
            if (!gInserted) {
                const cssLink = document.createElement("link");
                cssLink.type = "text/css";
                cssLink.rel = "stylesheet";
                cssLink.href = "https://cdn.plyr.io/3.7.8/plyr.css";
                document.head.appendChild(cssLink);

                const script = document.createElement("script");
                script.src = "https://cdn.plyr.io/3.7.8/plyr.js";
                const existingScript = document.body.getElementsByTagName("script")[0];
                if (existingScript) {
                    document.body.insertBefore(script, existingScript);
                } else {
                    document.body.appendChild(script);
                }

                gInserted = true;
                gInsertedScript = script;
            }
        }

        function instanceStyle(id, color, radius) {
            const style = document.createElement("style");
            style.innerHTML = `
                #${id} {
                    --plyr-color-main: ${color || "#00b3ff"};
                    border-radius: ${radius || "10"}px;
                }
            `;
            document.head.appendChild(style);
        }

        function init(options) {
            const {
                id,
                embed,
                loop = true,
                color,
                radius,
                controls = ["play-large", "play", "progress", "current-time", "mute", "volume", "captions", "settings", "pip", "airplay", "fullscreen"],
                settings = ["captions", "quality", "speed", "loop"],
                autoplay = false
            } = options;

            instanceStyle(id, color, radius);

            const container = document.getElementById(id);
            container.classList.add("plyr__video-embed");

            // Adiciona as opções para ocultar logo, título e outros controles no YouTube
            const iframe = document.createElement("iframe");
            iframe.src = `https://www.youtube.com/embed/${embed}?controls=0&modestbranding=1&showinfo=0&rel=0&iv_load_policy=3&fs=1&playsinline=1&enablejsapi=1`;
            iframe.allowFullscreen = true;
            iframe.allowtransparency = true;
            iframe.setAttribute("allow", "autoplay");

            const unmuteButton = document.createElement("button");
            unmuteButton.className = `${id}-unmute unmute-button`;
            unmuteButton.innerHTML = "&#128266; Ativar Áudio";

            container.appendChild(iframe);

            const player = new Plyr(`#${id}`, {
                loop: { active: loop },
                controls,
                settings,
                muted: autoplay ? false : true,
                keyboard: { focused: false, global: false }
            });

            player.on("ready", function () {
                const overlay = document.createElement("div");
                overlay.style.position = "absolute";
                overlay.style.top = "0";
                overlay.style.left = "0";
                overlay.style.width = "100%";
                overlay.style.height = "100vh";

                const videoWrapper = document.querySelector(`#${id} > div.plyr__video-wrapper`);
                videoWrapper.appendChild(overlay);

                document.querySelector(`#${id}`).style.filter = "blur(0)";

                if (autoplay) {
                    container.appendChild(unmuteButton);
                    unmuteButton.addEventListener("click", function () {
                        player.muted = false;
                        unmuteButton.style.display = "none";
                        player.currentTime = 0;
                        unmute = true;
                    });

                    player.on("click", function () {
                        if (player.muted && !unmute) {
                            player.muted = false;
                            unmuteButton.style.display = "none";
                            player.currentTime = 0;
                            player.play();
                            unmute = true;
                        } else if (!player.muted) {
                            unmuteButton.style.display = "none";
                        }
                    });

                    player.play();
                }
            });
        }

        function start(options) {
            globalInsert();
            if (gInsertedScript) {
                gInsertedScript.addEventListener("load", function () {
                    init(options);
                });
            } else {
                init(options);
            }
        }

        // Extrair parâmetros da URL para definir o vídeo embutido
        const urlParams = new URLSearchParams(window.location.search);
        const embed = urlParams.get("embed");

        start({
            id: 'player',
            embed: embed,
            loop: false,
            color: 'red',
            radius: '10',
            controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'captions', 'settings', 'pip', 'airplay', 'fullscreen'],
            settings: ['captions', 'quality', 'speed', 'loop'],
            autoplay: false,
        });
    </script>
</body>
</html>
